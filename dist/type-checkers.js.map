{"version":3,"file":"type-checkers.js","sources":["../source/defaultTypeChecker.js","../source/errorReporter.js","../source/enabled.js","../source/config.js","../source/proxy.js","../source/typeChecker.js","../source/index.js"],"sourcesContent":["let defaultTypeChecker;\n\nexport const getDefaultTypeChecker = () => defaultTypeChecker;\nexport const setDefaultTypeChecker = (typeChecker) => defaultTypeChecker = typeChecker;\n","const constructErrorString = (action, name, required, actual) =>\n  `TypeChecker error for \"${action}\" on \"${name}\" instead of \"${required}\" received \"${actual}\"`;\n\nexport const ConsoleErrorReporter = (action, name, requiredTypeString, actualTypeString) =>\n  console.error(constructErrorString(action, name, requiredTypeString, actualTypeString));\n\nexport const ConsoleWarnReporter = (action, name, requiredTypeString, actualTypeString) =>\n  console.warn(constructErrorString(action, name, requiredTypeString, actualTypeString));\n\nexport const ThrowErrorReporter = (action, name, requiredTypeString, actualTypeString) => {\n  throw new Error(constructErrorString(action, name, requiredTypeString, actualTypeString));\n};\n\nlet errorReporter = ConsoleErrorReporter;\n\nexport const getErrorReporter = () => errorReporter;\n\nexport const setErrorReporter = (reporter) => errorReporter = reporter;\n","let enabled = true;\n\nexport const isEnabled = () => enabled;\nexport const setEnabled = (value) => enabled = !!value;\n","export const configKey = Symbol('data-checkers::config');\n\nexport const getConfig = (target) => target[configKey];\nexport const setConfig = (target, config) => target[configKey] = config;\n\nexport const getTargetTypeChecker = (target) => target[configKey] && target[configKey].typeChecker;\nexport const getTargetTypeCheckerConfig = (target) => target[configKey] && target[configKey].config;\n","import { getDefaultTypeChecker } from './defaultTypeChecker';\nimport { getErrorReporter } from './errorReporter';\nimport { isEnabled } from './enabled';\nimport { getConfig, setConfig, configKey } from './config';\n\nconst validTypes = {\n  object: true,\n  function: true,\n};\n\nexport const isValidTarget = (target) => target && validTypes[typeof target];\n\nconst getProperty = (target, property) => {\n  // if object or function and deep -- wrap\n  const value = target[property];\n\n  if (property === configKey) {\n    return value;\n  }\n\n  const { deep, names, config, typeChecker } = getConfig(target);\n\n  typeChecker.getProperty && typeChecker.getProperty(target, property, value, config, names);\n\n  if ((deep && isValidTarget(value)) || value instanceof Function) {\n    const { children } = getConfig(target);\n\n    if (!children.hasOwnProperty(property)) {\n      children[property] = create(value, { deep, names: [...names, property] }, typeChecker);\n    }\n\n    return children[property];\n  }\n\n  return value;\n};\n\nconst setProperty = (target, property, value, receiver) => {\n  const { names, config, children, typeChecker } = getConfig(target);\n\n  if (property !== configKey) {\n    delete children[property];\n    typeChecker.setProperty && typeChecker.setProperty(target, property, value, config, names);\n  }\n\n  target[property] = value;\n};\n\nconst callFunction = (target, thisArg, argumentsList) => {\n  const { names, config, typeChecker } = getConfig(target);\n\n  typeChecker.arguments && typeChecker.arguments(target, thisArg, argumentsList, config, names);\n\n  const result = target.apply(thisArg, argumentsList);\n\n  typeChecker.returnValue && typeChecker.returnValue(target, thisArg, result, config, names);\n\n  return result;\n};\n\nconst objectProxy = (target) => new Proxy(\n  target,\n  {\n    get: getProperty,\n    set: setProperty,\n  },\n);\n\nconst functionProxy = (target) => new Proxy(\n  target,\n  {\n    apply: callFunction,\n    construct: callFunction,\n  },\n);\n\nexport const create = (target, { deep = true, names = [] } = {}, typeChecker = getDefaultTypeChecker()) => {\n  if (!isValidTarget(target) || !isEnabled() || getConfig(target)) {\n    return target;\n  }\n\n  setConfig(\n    target,\n    {\n      deep,\n      names,\n      children: {},\n      typeChecker,\n      config: typeChecker.init(target, getErrorReporter()),\n    },\n  );\n\n  if (target instanceof Function) {\n    return functionProxy(target);\n  }\n\n  return objectProxy(target);\n};\n","const buildPath = sequence => sequence\n  .reduce((str, name) => {\n    if (String(parseInt(name, 10)) === name) {\n      str = `${str}[${name}]`;\n    } else if (/^[a-z][\\w$]*$/i.test(name)) {\n      str = str ? `${str}.${name}` : name;\n    } else {\n      str = `${str}[\"${name}\"]`;\n    }\n\n    return str;\n  }, '');\n\nconst checkType = (action, types, name, type, errorReporter, sequence) => {\n  if (!type) {\n    return true;\n  }\n\n  const storedType = types[name];\n\n  if (storedType) {\n    // TODO add possibility to store function in types[name] that can be called to identify if there are type error\n    if (storedType !== type) {\n      errorReporter(action, buildPath([...sequence, name]), types[name], type);\n\n      return false;\n    }\n  } else {\n    types[name] = type;\n  }\n\n  return true;\n};\n\nconst GET_PROPERTY = 'getProperty';\nconst SET_PROPERTY = 'setProperty';\nconst ARGUMENTS = 'arguments';\nconst RETURN_VALUE = 'returnValue';\n\nconst PrimitiveTypeChecker = {\n  collectTypesOnInit: true,\n\n  getTypeString(value) {\n    if (value === undefined) {\n      return '';\n    } else if (value instanceof Array) {\n      return 'array';\n    }\n\n    return typeof value;\n  },\n\n  init(target, errorReporter) {\n    const types = {};\n\n    if (this.collectTypesOnInit) {\n      Object.keys(target)\n        .forEach((key) => {\n          types[key] = this.getTypeString(target[key]);\n        });\n    }\n\n    return {\n      types,\n      errorReporter,\n    };\n  },\n\n  getProperty(target, name, value, { types, errorReporter }, sequence) {\n    return checkType(\n      GET_PROPERTY,\n      types,\n      name,\n      this.getTypeString(value),\n      errorReporter,\n      sequence,\n    );\n  },\n\n  setProperty(target, name, newValue, { types, errorReporter }, sequence) {\n    return checkType(\n      SET_PROPERTY,\n      types,\n      name,\n      this.getTypeString(newValue),\n      errorReporter,\n      sequence,\n    );\n  },\n\n  arguments(target, thisArg, args, { types, errorReporter }, sequence) {\n    const { length } = args;\n    let valid = true;\n\n    for (let index = 0; index < length; index++) {\n      const agrValid = checkType(\n        ARGUMENTS,\n        types,\n        String(index),\n        this.getTypeString(args[index]),\n        errorReporter,\n        sequence,\n      );\n\n      valid = agrValid && valid;\n    }\n\n    return valid;\n  },\n\n  returnValue(target, thisArg, value, { types, errorReporter }, sequence) {\n    return checkType(\n      RETURN_VALUE,\n      types,\n      '',\n      this.getTypeString(value),\n      errorReporter,\n      sequence,\n    );\n  },\n};\n\nexport default PrimitiveTypeChecker;\n","import {\n  getDefaultTypeChecker,\n  setDefaultTypeChecker,\n} from './defaultTypeChecker';\nimport {\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n  getErrorReporter,\n  setErrorReporter,\n  ThrowErrorReporter,\n} from './errorReporter';\nimport {\n  isEnabled,\n  setEnabled,\n} from './enabled';\nimport {\n  getTargetTypeChecker,\n  getTargetTypeCheckerConfig,\n} from './config';\nimport {\n  create,\n  isValidTarget,\n} from './proxy';\nimport PrimitiveTypeChecker from './typeChecker';\n\nexport {\n  getDefaultTypeChecker,\n  setDefaultTypeChecker,\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n  getErrorReporter,\n  setErrorReporter,\n  ThrowErrorReporter,\n  isEnabled,\n  setEnabled,\n  getTargetTypeChecker,\n  getTargetTypeCheckerConfig,\n  create,\n  isValidTarget,\n};\n\nsetDefaultTypeChecker(PrimitiveTypeChecker);\n\nexport default create;\n"],"names":["defaultTypeChecker","getDefaultTypeChecker","setDefaultTypeChecker","typeChecker","constructErrorString","action","name","required","actual","ConsoleErrorReporter","requiredTypeString","actualTypeString","console","error","ConsoleWarnReporter","warn","ThrowErrorReporter","Error","errorReporter","getErrorReporter","setErrorReporter","reporter","enabled","isEnabled","setEnabled","value","configKey","Symbol","getConfig","target","setConfig","config","getTargetTypeChecker","getTargetTypeCheckerConfig","validTypes","object","function","isValidTarget","getProperty","property","deep","names","Function","children","hasOwnProperty","create","setProperty","receiver","callFunction","thisArg","argumentsList","arguments","result","apply","returnValue","objectProxy","Proxy","get","set","functionProxy","construct","init","buildPath","sequence","reduce","str","String","parseInt","test","checkType","types","type","storedType","GET_PROPERTY","SET_PROPERTY","ARGUMENTS","RETURN_VALUE","PrimitiveTypeChecker","collectTypesOnInit","getTypeString","undefined","Array","Object","keys","forEach","key","newValue","args","length","valid","index","agrValid"],"mappings":"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"}