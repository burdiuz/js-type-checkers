{"version":3,"file":"type-checkers.js","sources":["../source/checkers/index.js","../source/proxy/config.js","../source/reporters/utils.js","../source/reporters/console.js","../source/reporters/error.js","../source/reporters/index.js","../source/enabled.js","../source/target/info.js","../source/target/proxy.js","../source/utils.js","../source/proxy/getProperty.js","../source/proxy/setProperty.js","../source/proxy/utils.js","../source/proxy/callFunction.js","../source/proxy/create.js","../source/proxy/createDeep.js","../source/target/object/merge.js","../source/target/object/properties.js"],"sourcesContent":["let defaultTypeChecker = null;\n\nconst getDefaultTypeChecker = () => defaultTypeChecker;\nconst setDefaultTypeChecker = (typeChecker) => {\n  defaultTypeChecker = typeChecker;\n};\n\nexport {\n  getDefaultTypeChecker,\n  setDefaultTypeChecker,\n};\n","import hasOwn from '@actualwave/hasOwn';\n\nexport const PROXY_WRAP_FUNCTION_RETURN_VALUES = 'wrapFunctionReturnValues';\nexport const PROXY_WRAP_FUNCTION_ARGUMENTS = 'wrapFunctionArguments';\nexport const PROXY_WRAP_SET_PROPERTY_VALUES = 'wrapSetPropertyValues';\nexport const PROXY_IGNORE_PROTOTYPE_METHODS = 'ignorePrototypeMethods';\n\nexport const getDefaultProxyConfig = () => ({\n  [PROXY_WRAP_FUNCTION_RETURN_VALUES]: true,\n  [PROXY_WRAP_FUNCTION_ARGUMENTS]: false,\n  [PROXY_WRAP_SET_PROPERTY_VALUES]: true,\n  [PROXY_IGNORE_PROTOTYPE_METHODS]: false,\n});\n\nconst config = getDefaultProxyConfig();\n\nexport const setProxyConfig = (newConfig) => Object.assign(config, newConfig);\n\nexport const getProxyConfig = () => ({ ...config });\n\nexport const getProxyConfigValue = (key, info = null) =>\n  (hasOwn(info, key) ? info[key] : config[key]);\n","export const constructErrorString = (action, name, required, actual) =>\n  `${action}Error on \"${name}\" instead of \"${required}\" received \"${actual}\"`;\n","import { constructErrorString } from './utils';\n\nexport const ConsoleErrorReporter = (action, name, requiredTypeString, actualTypeString) =>\n  console.error(constructErrorString(action, name, requiredTypeString, actualTypeString));\n\nexport const ConsoleWarnReporter = (action, name, requiredTypeString, actualTypeString) =>\n  console.warn(constructErrorString(action, name, requiredTypeString, actualTypeString));\n","import { constructErrorString } from './utils';\n\nexport const ThrowErrorReporter = (action, name, requiredTypeString, actualTypeString) => {\n  throw new Error(constructErrorString(action, name, requiredTypeString, actualTypeString));\n};\n","import {\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n} from './console';\nimport { ThrowErrorReporter } from './error';\n\nlet errorReporter = ConsoleErrorReporter;\n\nconst getErrorReporter = () => errorReporter;\n\nconst setErrorReporter = (reporter) => {\n  errorReporter = reporter;\n};\n\nexport {\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n  ThrowErrorReporter,\n  getErrorReporter,\n  setErrorReporter,\n};\n","let enabled = true;\n\nexport const isEnabled = () => enabled;\nexport const setEnabled = (value = true) => {\n  enabled = !!value;\n};\n","import hasOwn from '@actualwave/hasOwn';\n\nexport const INFO_KEY = Symbol('type-checkers::info');\n\nexport const createChildrenCache = (children = {}) => ({ ...children });\n\nexport const createTargetInfo = (\n  checker,\n  config,\n  deep = true,\n  names = [],\n  children = createChildrenCache(),\n) => ({\n  checker,\n  config,\n  deep,\n  names,\n  children,\n});\n\nexport const getTargetInfo = (target) => (target ? target[INFO_KEY] : undefined);\n\nexport const setTargetInfo = (target, info) => {\n  if (target && info) {\n    target[INFO_KEY] = info;\n  }\n};\n\nexport const hasTargetInfo = (target) => !!getTargetInfo(target);\n\nexport const getTargetTypeChecker = (target) =>\n  (target && target[INFO_KEY] ? target[INFO_KEY].checker : undefined);\n\nexport const getTargetTypeCheckerConfig = (target) => {\n  if (!target || !target[INFO_KEY]) {\n    return undefined;\n  }\n\n  return target[INFO_KEY].config;\n};\n\n/*\n  I have had to apply custom key instead of name as is to\n  fix \"construtor\" issue. Since ordinary object has some\n  properties with values from start, these properties were\n  mustakenly returned as child info objects, for example, if\n  requesting hild info for \"constructor\" function of the target,\n  it returned class constructor which caused errors later,\n  when accesing info properties.\n */\nconst getChildInfoKey = (name) => `@${name}`;\n\nexport const mergeChildrenCache = (targetCache, sourceCache) => {\n  // eslint-disable-next-line guard-for-in\n  for (const name in sourceCache) {\n    const key = getChildInfoKey(name);\n\n    if (hasOwn(targetCache, key)) {\n      // eslint-disable-next-line no-use-before-define\n      targetCache[key] = mergeTargetInfo(targetCache[key], sourceCache[key]);\n    } else {\n      targetCache[key] = sourceCache[key];\n    }\n  }\n\n  return targetCache;\n};\n\nexport const storeChildInfo = (cache, name, childInfo) => {\n  const key = getChildInfoKey(name);\n  delete cache[key];\n\n  if (childInfo) {\n    cache[key] = childInfo;\n  }\n};\n\nexport const storeChildInfoFrom = (cache, name, child) => {\n  storeChildInfo(cache, name, getTargetInfo(child));\n};\n\nexport const getChildInfo = (cache, name) => cache[getChildInfoKey(name)];\n\nexport const hasChildInfo = (cache, name) => !!cache[getChildInfoKey(name)];\n\nexport const removeChildInfo = (cache, name) => delete cache[getChildInfoKey(name)];\n\nexport const mergeTargetInfo = (targetInfo, sourceInfo) => {\n  const { deep, checker, children, config, names } = targetInfo;\n\n  if (checker === sourceInfo.checker) {\n    targetInfo.deep = deep || sourceInfo.deep;\n    targetInfo.children = mergeChildrenCache(children, sourceInfo.children);\n    targetInfo.config = checker.mergeConfigs(config, sourceInfo.config, names);\n  } else {\n    console.error('TypeChecked objects can be merged only if using exactly same instance of type checker.');\n  }\n\n  return targetInfo;\n};\n","export const TARGET_KEY = Symbol('type-checkers::target');\n\nexport const getOriginalTarget = (target) => {\n  return target[TARGET_KEY] || target;\n};\n","import { TARGET_KEY } from './target/proxy';\n\nconst validTypes = {\n  object: true,\n  function: true,\n};\n\nexport const isValidTarget = (target) => Boolean(target && validTypes[typeof target]);\nexport const isTypeChecked = (target) => Boolean(target && target[TARGET_KEY]);\n","import hasOwn from '@actualwave/hasOwn';\n\nimport {\n  INFO_KEY,\n  getTargetInfo,\n  getChildInfo,\n  storeChildInfoFrom,\n} from '../target/info';\n\nimport {\n  getProxyConfigValue,\n  PROXY_IGNORE_PROTOTYPE_METHODS,\n} from './config';\n\nimport {\n  isValidTarget,\n  isTypeChecked,\n} from '../utils';\n\nimport { TARGET_KEY } from '../target/proxy';\n\nconst getTargetProperty = (createFn, target, property, value) => {\n  const info = getTargetInfo(target);\n  const { deep, children, names, checker } = info;\n\n  if (deep || value instanceof Function) {\n    const childInfo = getChildInfo(children, property);\n\n    if (childInfo) {\n      value = createFn(value, { info: childInfo });\n    } else {\n      value = createFn(value, { deep, names: [...names, property], checker });\n      storeChildInfoFrom(children, property, value);\n    }\n  }\n\n  return value;\n};\n\nconst isIgnoredProperty = (target, info, property, value) => {\n  if (\n    value instanceof Function\n    && !hasOwn(target, property)\n    && getProxyConfigValue(PROXY_IGNORE_PROTOTYPE_METHODS, info)\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nconst getProperty = (createFn) => (target, property) => {\n  const value = target[property];\n\n  if (property === INFO_KEY) {\n    return value;\n    /*\n    target[TARGET_KEY] is a virtual property accessing which indicates\n    if object is wrapped with type checked proxy or not.\n    */\n  } else if (property === TARGET_KEY) {\n    return target;\n  }\n\n  const info = getTargetInfo(target);\n  const { names, config, checker } = info;\n\n  if (checker.getProperty) {\n    checker.getProperty(target, property, value, config, names);\n  }\n\n  if (\n    !isValidTarget(value)\n    || isTypeChecked(value)\n    || isIgnoredProperty(target, info, property, value)\n  ) {\n    return value;\n  }\n\n  return getTargetProperty(createFn, target, property, value);\n};\n\nexport default getProperty;\n","import {\n  INFO_KEY,\n  getTargetInfo,\n  getChildInfo,\n  storeChildInfoFrom,\n  mergeTargetInfo,\n} from '../target/info';\n\nimport {\n  getProxyConfigValue,\n  PROXY_WRAP_SET_PROPERTY_VALUES,\n} from './config';\n\nimport {\n  isValidTarget,\n  isTypeChecked,\n} from '../utils';\n\nimport { TARGET_KEY } from '../target/proxy';\n\nconst setNonTargetProperty = (target, property, value) => {\n  if (property === INFO_KEY) {\n    let info = getTargetInfo(target);\n    if (info && value && info !== value) {\n      info = mergeTargetInfo(info, value);\n    } else {\n      info = value;\n    }\n\n    target[property] = info;\n    return true;\n  } else if (!isValidTarget(value)) {\n    const { names, config, checker } = getTargetInfo(target);\n\n    if (checker.setProperty) {\n      checker.setProperty(target, property, value, config, names);\n    }\n\n    target[property] = value;\n    return true;\n  }\n\n  return false;\n};\n\nconst setTargetProperty = (createFn, target, property, value) => {\n  const info = getTargetInfo(target);\n  const { deep, names, checker, config, children } = info;\n\n  if (checker.setProperty) {\n    checker.setProperty(target, property, value, config, names);\n  }\n\n  if (getProxyConfigValue(PROXY_WRAP_SET_PROPERTY_VALUES, info)) {\n    if (!isTypeChecked(value)) {\n      const childInfo = getChildInfo(children, property);\n\n      if (childInfo) {\n        value = createFn(value, { info: childInfo });\n      } else {\n        value = createFn(value, { deep, names: [...names, property], checker });\n      }\n    }\n\n    storeChildInfoFrom(children, property, value);\n  }\n\n  target[property] = value;\n  return true;\n};\n\nconst setProperty = (createFn) => (target, property, value) => {\n  if (property === TARGET_KEY) {\n    throw new Error(`\"${TARGET_KEY}\" is a virtual property and cannot be set`);\n  }\n\n  return setNonTargetProperty(target, property, value)\n    || setTargetProperty(createFn, target, property, value);\n};\n\nexport default setProperty;\n","import { isTypeChecked, isValidTarget } from '../utils';\nimport { getChildInfo, storeChildInfoFrom } from '../target/info';\n\nexport const getTypeCheckedChild = (createFn, info, name, value) => {\n  if (!isValidTarget(value)) {\n    return value;\n  }\n\n  let result = value;\n\n  if (!isTypeChecked(value)) {\n    const { children } = info;\n    const childInfo = getChildInfo(children, name);\n\n    if (childInfo) {\n      result = createFn(value, { info: childInfo });\n    } else {\n      const { deep, names, checker } = info;\n      result = createFn(value, { deep, names: [...names, name], checker });\n      storeChildInfoFrom(children, name, result);\n    }\n  }\n\n  return result;\n};\n","import { getTargetInfo } from '../target/info';\n\nimport {\n  getProxyConfigValue,\n  PROXY_WRAP_FUNCTION_ARGUMENTS,\n  PROXY_WRAP_FUNCTION_RETURN_VALUES\n} from './config';\n\nimport { getTypeCheckedChild } from './utils';\n\nconst getTargetArguments = (createFn, target, argumentsList) => {\n  const info = getTargetInfo(target);\n\n  if (getProxyConfigValue(PROXY_WRAP_FUNCTION_ARGUMENTS, info)) {\n    const { length } = argumentsList;\n    // FIXME cache arguments info objects as children\n    for (let index = 0; index < length; index++) {\n      argumentsList[index] = getTypeCheckedChild(\n        createFn,\n        info,\n        String(index),\n        argumentsList[index]\n      );\n    }\n  }\n\n  return argumentsList;\n};\n\nconst callFunction = (createFn) => (target, thisArg, argumentsList) => {\n  const info = getTargetInfo(target);\n  const { names, config, checker } = info;\n\n  if (checker.arguments) {\n    checker.arguments(target, thisArg, argumentsList, config, names);\n  }\n\n  argumentsList = getTargetArguments(createFn, target, argumentsList);\n\n  let result = target.apply(thisArg, argumentsList);\n\n  if (checker.returnValue) {\n    checker.returnValue(target, thisArg, result, config, names);\n  }\n\n  if (getProxyConfigValue(PROXY_WRAP_FUNCTION_RETURN_VALUES, info)) {\n    result = getTypeCheckedChild(createFn, info, 'returnValue', result);\n  }\n\n  return result;\n};\n\nexport default callFunction;\n","import { getDefaultTypeChecker } from '../checkers';\nimport { getErrorReporter } from '../reporters';\nimport { isEnabled } from '../enabled';\nimport {\n  createTargetInfo,\n  setTargetInfo,\n  createChildrenCache,\n} from '../target/info';\nimport { isValidTarget, isTypeChecked } from '../utils';\nimport getPropertyInit from './getProperty';\nimport setPropertyInit from './setProperty';\nimport callFunctionInit from './callFunction';\n\nlet getProperty;\nlet setProperty;\nlet callFunction;\n\nconst objectProxy = (target) => new Proxy(\n  target,\n  {\n    get: getProperty,\n    set: setProperty,\n  },\n);\n\nconst functionProxy = (target) => new Proxy(\n  target,\n  {\n    get: getProperty,\n    set: setProperty,\n    apply: callFunction,\n    construct: callFunction,\n  },\n);\n\nexport const wrapWithProxy = (target) => {\n  if (target instanceof Function) {\n    return functionProxy(target);\n  }\n\n  return objectProxy(target);\n};\n\nexport const createInfoFromOptions = (target, {\n  deep = true,\n  names = [],\n  config = null,\n  children = null,\n  checker = getDefaultTypeChecker(),\n  info = null, // exclusive option, if set other options being ignored\n} = {}) => info || createTargetInfo(\n  checker,\n  checker.init(target, getErrorReporter(), config),\n  deep,\n  names,\n  createChildrenCache(children),\n);\n\nconst create = (target, options) => {\n  if (!isValidTarget(target) || !isEnabled() || isTypeChecked(target)) {\n    return target;\n  }\n\n  setTargetInfo(\n    target,\n    createInfoFromOptions(target, options),\n  );\n\n  return wrapWithProxy(target);\n};\n\ngetProperty = getPropertyInit(create);\nsetProperty = setPropertyInit(create);\ncallFunction = callFunctionInit(create);\n\nexport default create;\n","import { isEnabled } from '../enabled';\nimport {\n  setTargetInfo,\n  storeChildInfo,\n  getChildInfo,\n} from '../target/info';\nimport { isTypeChecked } from '../utils';\nimport { wrapWithProxy, createInfoFromOptions } from './create';\n\nconst deepInitializer = (target, options) => {\n  const info = createInfoFromOptions(target, options);\n  const { deep, names, checker, config, children } = info;\n\n  Object.keys(target)\n    .forEach((name) => {\n      const value = target[name];\n\n      checker.getProperty(target, name, value, config, names);\n\n      // skip functions/methods since we get info about them only when being executed\n      if (typeof value === 'object') {\n        let childInfo = getChildInfo(children, name);\n\n        if (childInfo) {\n          deepInitializer(value, { info: childInfo });\n        } else {\n          childInfo = deepInitializer(value, { deep, names: [...names, name], checker });\n          storeChildInfo(children, name, childInfo);\n        }\n      }\n    });\n\n  setTargetInfo(target, info);\n\n  return info;\n};\n\nconst createDeep = (target, options) => {\n  if (!target || typeof target !== 'object' || !isEnabled() || isTypeChecked(target)) {\n    return target;\n  }\n\n  deepInitializer(target, options);\n\n  return wrapWithProxy(target);\n};\n\nexport default createDeep;\n","import {\n  getTargetInfo,\n  hasTargetInfo,\n} from '../info';\n\nimport create from '../../proxy/create';\n\nimport { isEnabled } from '../../enabled';\n\nconst objectMerge = (options, ...sources) => {\n  let target = {};\n\n  if (isEnabled()) {\n    if (!options) {\n      options = {\n        info: getTargetInfo(sources.find((item) => hasTargetInfo(item))),\n        deep: false,\n      };\n    }\n\n    target = create(target, options);\n  }\n\n  return Object.assign(target, ...sources);\n};\n\nexport default objectMerge;\n","import { isEnabled } from '../../enabled';\nimport { isValidTarget, isTypeChecked } from '../../utils';\nimport create from '../../proxy/create';\n\n// TODO if enabled, replaces original value with type checked\nconst properties = (target, options = undefined, ...names) => {\n  if (!isEnabled()) {\n    return target;\n  }\n\n  if (!isValidTarget(target)) {\n    throw new Error('Target must be a valid object.');\n  }\n\n  if (Object.isFrozen(target) || Object.isSealed(target)) {\n    throw new Error('Target object should not be sealed or frozen.');\n  }\n\n  if (!names.length) {\n    // Symbols and non-enumerables must be explicitly specified\n    names = Object.keys(target);\n  }\n\n  const { length } = names;\n  for (let index = 0; index < length; index += 1) {\n    const name = names[index];\n    const { writable, get, set } = Object.getOwnPropertyDescriptor(target, name);\n\n    // Prohibit applying to properties with accessor/mutator pair?\n    if ((get && set) || writable) {\n      const value = target[name];\n\n      if (isValidTarget(value) && !isTypeChecked(value)) {\n        target[name] = create(value, options);\n      }\n    }\n  }\n\n  return target;\n};\n\nexport default properties;\n"],"names":["defaultTypeChecker","getDefaultTypeChecker","setDefaultTypeChecker","typeChecker","PROXY_WRAP_FUNCTION_RETURN_VALUES","PROXY_WRAP_FUNCTION_ARGUMENTS","PROXY_WRAP_SET_PROPERTY_VALUES","PROXY_IGNORE_PROTOTYPE_METHODS","getDefaultProxyConfig","config","setProxyConfig","newConfig","Object","assign","getProxyConfig","getProxyConfigValue","key","info","hasOwn","constructErrorString","action","name","required","actual","ConsoleErrorReporter","requiredTypeString","actualTypeString","console","error","ConsoleWarnReporter","warn","ThrowErrorReporter","Error","errorReporter","getErrorReporter","setErrorReporter","reporter","enabled","isEnabled","setEnabled","value","INFO_KEY","Symbol","createChildrenCache","children","createTargetInfo","checker","deep","names","getTargetInfo","target","undefined","setTargetInfo","hasTargetInfo","getTargetTypeChecker","getTargetTypeCheckerConfig","getChildInfoKey","mergeChildrenCache","targetCache","sourceCache","mergeTargetInfo","storeChildInfo","cache","childInfo","storeChildInfoFrom","child","getChildInfo","targetInfo","sourceInfo","mergeConfigs","TARGET_KEY","getOriginalTarget","validTypes","isValidTarget","Boolean","isTypeChecked","getTargetProperty","createFn","property","Function","isIgnoredProperty","getProperty","setNonTargetProperty","setProperty","setTargetProperty","getTypeCheckedChild","result","getTargetArguments","argumentsList","length","index","String","callFunction","thisArg","arguments","apply","returnValue","objectProxy","Proxy","functionProxy","wrapWithProxy","createInfoFromOptions","init","create","options","getPropertyInit","setPropertyInit","callFunctionInit","deepInitializer","keys","forEach","createDeep","objectMerge","sources","find","item","properties","isFrozen","isSealed","writable","get","set","getOwnPropertyDescriptor"],"mappings":"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"}