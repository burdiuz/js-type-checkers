{"version":3,"file":"type-checkers.js","sources":["../source/checkers/index.js","../source/proxy/config.js","../node_modules/@actualwave/is-function/is-function.js","../node_modules/@actualwave/with-proxy/with-proxy.js","../source/reporters/utils.js","../source/reporters/console.js","../source/reporters/error.js","../source/reporters/index.js","../source/enabled.js","../source/target/info.js","../source/target/proxy.js","../source/utils.js","../source/proxy/getProperty.js","../source/proxy/setProperty.js","../source/proxy/utils.js","../source/proxy/callFunction.js","../source/proxy/create.js","../source/proxy/createDeep.js","../source/target/object/merge.js","../source/target/object/properties.js"],"sourcesContent":["let defaultTypeChecker = null;\n\nconst getDefaultTypeChecker = () => defaultTypeChecker;\nconst setDefaultTypeChecker = (typeChecker) => {\n  defaultTypeChecker = typeChecker;\n};\n\nexport {\n  getDefaultTypeChecker,\n  setDefaultTypeChecker,\n};\n","import hasOwn from '@actualwave/has-own';\n\nexport const WRAP_FUNCTION_RETURN_VALUES = 'wrapFunctionReturnValues';\nexport const WRAP_FUNCTION_ARGUMENTS = 'wrapFunctionArguments';\nexport const WRAP_SET_PROPERTY_VALUES = 'wrapSetPropertyValues';\nexport const PROXY_IGNORE_PROTOTYPE_METHODS = 'ignorePrototypeMethods';\n\nexport const getDefaultWrapConfig = () => ({\n  [WRAP_FUNCTION_RETURN_VALUES]: true,\n  [WRAP_FUNCTION_ARGUMENTS]: false,\n  [WRAP_SET_PROPERTY_VALUES]: true,\n  [PROXY_IGNORE_PROTOTYPE_METHODS]: false,\n});\n\nconst config = getDefaultWrapConfig();\n\nexport const setWrapConfig = (newConfig) => Object.assign(config, newConfig);\n\nexport const getWrapConfig = () => ({ ...config });\n\nexport const getWrapConfigValue = (key, info = null) =>\n  (hasOwn(info, key) ? info[key] : config[key]);\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst isFunction = (target) => (typeof target === 'function');\n\nexports.isFunction = isFunction;\nexports.default = isFunction;","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst { isFunction } = require('@actualwave/is-function');\n\nconst withProxy = (handlers) => {\n  /*\n   have problems with using rest operator here, when in node_modules without additional \n   configurations, so using old style code\n  */\n  const { apply, construct } = handlers;\n\n  delete handlers.apply;\n  delete handlers.construct;\n\n  const functionHandlers = { ...handlers, construct, apply };\n\n  return (target) => new Proxy(target, isFunction(target) ? functionHandlers : handlers);\n};\n\nexports.withProxy = withProxy;\nexports.default = withProxy;\n","/* eslint-disable import/prefer-default-export */\n\nexport const constructErrorString = (action, name, required, received) =>\n  `${action}Error on \"${name}\" instead of \"${required}\" received \"${received}\"`;\n","/* eslint-disable no-console */\nimport { constructErrorString } from './utils';\n\nexport const ConsoleErrorReporter = (\n  action,\n  name,\n  requiredTypeString,\n  actualTypeString,\n) =>\n  console.error(constructErrorString(action, name, requiredTypeString, actualTypeString));\n\nexport const ConsoleWarnReporter = (\n  action,\n  name,\n  requiredTypeString,\n  actualTypeString,\n) =>\n  console.warn(constructErrorString(action, name, requiredTypeString, actualTypeString));\n","/* eslint-disable import/prefer-default-export */\n\nimport { constructErrorString } from './utils';\n\nexport const ThrowErrorReporter = (\n  action,\n  name,\n  requiredTypeString,\n  receivedTypeString,\n) => {\n  throw new Error(constructErrorString(action, name, requiredTypeString, receivedTypeString));\n};\n","import {\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n} from './console';\nimport { ThrowErrorReporter } from './error';\n\nlet errorReporter = ConsoleErrorReporter;\n\nconst getErrorReporter = () => errorReporter;\n\nconst setErrorReporter = (reporter) => {\n  errorReporter = reporter;\n};\n\nexport {\n  ConsoleErrorReporter,\n  ConsoleWarnReporter,\n  ThrowErrorReporter,\n  getErrorReporter,\n  setErrorReporter,\n};\n","let enabled = true;\n\nexport const isEnabled = () => enabled;\nexport const setEnabled = (value = true) => {\n  enabled = !!value;\n};\n","import hasOwn from '@actualwave/has-own';\n\nexport const INFO_KEY = Symbol('type-checkers::info');\n\nexport const createChildrenCache = (children = {}) => ({ ...children });\n\nexport const createTargetInfo = (\n  checker,\n  config,\n  deep = true,\n  names = [],\n  children = createChildrenCache(),\n) => ({\n  checker,\n  config,\n  deep,\n  names,\n  children,\n});\n\nexport const getTargetInfo = (target) =>\n  (target ? target[INFO_KEY] : undefined);\n\nexport const setTargetInfo = (target, info) => {\n  if (target && info) {\n    target[INFO_KEY] = info;\n  }\n};\n\nexport const hasTargetInfo = (target) => !!getTargetInfo(target);\n\n// TODO three times getting same, might need optimizing\nexport const getTypeChecker = (target) => {\n  if (target) {\n    const info = target[INFO_KEY];\n\n    return (info && info.checker) || undefined;\n  }\n\n  return undefined;\n};\n\nexport const getTypeCheckerData = (target) => {\n  if (target) {\n    const info = target[INFO_KEY];\n\n    return (info && info.config) || undefined;\n  }\n\n  return undefined;\n};\n\n/*\n  I have had to apply custom key instead of name as is to\n  fix \"construtor\" issue. Since ordinary object has some\n  properties with values from start, these properties were\n  mustakenly returned as child info objects, for example, if\n  requesting hild info for \"constructor\" function of the target,\n  it returned class constructor which caused errors later,\n  when accesing info properties.\n */\nconst getChildInfoKey = (name) => `@${name}`;\n\nexport const mergeChildrenCache = (targetCache, sourceCache) => {\n  for (const key in sourceCache) {\n    if (hasOwn(targetCache, key)) {\n      // eslint-disable-next-line no-use-before-define\n      targetCache[key] = mergeTargetInfo(targetCache[key], sourceCache[key]);\n    } else {\n      targetCache[key] = sourceCache[key];\n    }\n  }\n\n  return targetCache;\n};\n\nexport const storeChildInfo = (cache, name, childInfo) => {\n  const key = getChildInfoKey(name);\n  delete cache[key];\n\n  if (childInfo) {\n    cache[key] = childInfo;\n  }\n};\n\nexport const storeChildInfoFrom = (cache, name, child) => {\n  storeChildInfo(cache, name, getTargetInfo(child));\n};\n\nexport const getChildInfo = (cache, name) => cache[getChildInfoKey(name)];\n\nexport const hasChildInfo = (cache, name) => !!cache[getChildInfoKey(name)];\n\nexport const removeChildInfo = (cache, name) =>\n  delete cache[getChildInfoKey(name)];\n\nexport const mergeTargetInfo = (targetInfo, sourceInfo) => {\n  const { deep, checker, children, config, names } = targetInfo;\n\n  if (checker === sourceInfo.checker) {\n    targetInfo.deep = deep || sourceInfo.deep;\n    targetInfo.children = mergeChildrenCache(children, sourceInfo.children);\n    targetInfo.config = checker.mergeConfigs(config, sourceInfo.config, names);\n  } else {\n    console.error('TypeChecked objects can be merged only if using exactly same instance of type checker.');\n  }\n\n  return targetInfo;\n};\n","export const TARGET_KEY = Symbol('type-checkers::target');\n\nexport const unwrap = (target) =>\n  (target && target[TARGET_KEY]) || target;\n","import { TARGET_KEY } from './target/proxy';\n\nconst validTypes = {\n  object: true,\n  function: true,\n};\n\nexport const isWrappable = (target) => Boolean(target && validTypes[typeof target]);\nexport const isWrapped = (target) => Boolean(target && target[TARGET_KEY]);\n","import hasOwn from '@actualwave/has-own';\nimport isFunction from '@actualwave/is-function';\n\nimport {\n  INFO_KEY,\n  getTargetInfo,\n  getChildInfo,\n  storeChildInfoFrom,\n} from '../target/info';\n\nimport { getWrapConfigValue, PROXY_IGNORE_PROTOTYPE_METHODS } from './config';\n\nimport { isWrappable, isWrapped } from '../utils';\n\nimport { TARGET_KEY } from '../target/proxy';\n\nconst getTargetProperty = (wrapFn, target, property, value) => {\n  const info = getTargetInfo(target);\n  const { deep, children, names, checker } = info;\n\n  if (deep || isFunction(value)) {\n    const childInfo = getChildInfo(children, property);\n\n    if (childInfo) {\n      value = wrapFn(value, { info: childInfo });\n    } else {\n      value = wrapFn(value, { deep, names: [...names, property], checker });\n      storeChildInfoFrom(children, property, value);\n    }\n  }\n\n  return value;\n};\n\nconst isIgnoredProperty = (target, info, property, value) => {\n  if (\n    isFunction(value)\n    && !hasOwn(target, property)\n    && getWrapConfigValue(PROXY_IGNORE_PROTOTYPE_METHODS, info)\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nconst getProperty = (wrapFn) => (target, property) => {\n  const value = target[property];\n\n  if (property === INFO_KEY) {\n    return value;\n    /*\n    target[TARGET_KEY] is a virtual property accessing which indicates\n    if object is wrapped with type checked proxy or not.\n    */\n  } else if (property === TARGET_KEY) {\n    return target;\n  }\n\n  const info = getTargetInfo(target);\n  const { names, config, checker } = info;\n\n  if (checker.getProperty) {\n    checker.getProperty(target, property, value, config, names);\n  }\n\n  if (\n    !isWrappable(value) ||\n    isWrapped(value) ||\n    isIgnoredProperty(target, info, property, value)\n  ) {\n    return value;\n  }\n\n  return getTargetProperty(wrapFn, target, property, value);\n};\n\nexport default getProperty;\n","import {\n  INFO_KEY,\n  getTargetInfo,\n  getChildInfo,\n  storeChildInfoFrom,\n  mergeTargetInfo,\n} from '../target/info';\n\nimport {\n  getWrapConfigValue,\n  WRAP_SET_PROPERTY_VALUES,\n} from './config';\n\nimport {\n  isWrappable,\n  isWrapped,\n} from '../utils';\n\nimport { TARGET_KEY } from '../target/proxy';\n\nconst setNonTargetProperty = (target, property, value) => {\n  if (property === INFO_KEY) {\n    let info = getTargetInfo(target);\n    if (info && value && info !== value) {\n      info = mergeTargetInfo(info, value);\n    } else {\n      info = value;\n    }\n\n    target[property] = info;\n    return true;\n  } else if (!isWrappable(value)) {\n    const { names, config, checker } = getTargetInfo(target);\n\n    if (checker.setProperty) {\n      checker.setProperty(target, property, value, config, names);\n    }\n\n    target[property] = value;\n    return true;\n  }\n\n  return false;\n};\n\nconst setTargetProperty = (wrapFn, target, property, value) => {\n  const info = getTargetInfo(target);\n  const { deep, names, checker, config, children } = info;\n\n  if (checker.setProperty) {\n    checker.setProperty(target, property, value, config, names);\n  }\n\n  if (getWrapConfigValue(WRAP_SET_PROPERTY_VALUES, info)) {\n    if (!isWrapped(value)) {\n      const childInfo = getChildInfo(children, property);\n\n      if (childInfo) {\n        value = wrapFn(value, { info: childInfo });\n      } else {\n        value = wrapFn(value, { deep, names: [...names, property], checker });\n      }\n    }\n\n    storeChildInfoFrom(children, property, value);\n  }\n\n  target[property] = value;\n  return true;\n};\n\nconst setProperty = (wrapFn) => (target, property, value) => {\n  if (property === TARGET_KEY) {\n    throw new Error(`\"${TARGET_KEY}\" is a virtual property and cannot be set`);\n  }\n\n  return setNonTargetProperty(target, property, value)\n    || setTargetProperty(wrapFn, target, property, value);\n};\n\nexport default setProperty;\n","/* eslint-disable import/prefer-default-export */\n\nimport { isWrapped, isWrappable } from '../utils';\nimport { getChildInfo, storeChildInfoFrom } from '../target/info';\n\nexport const getTypeCheckedChild = (wrapFn, info, name, value) => {\n  if (!isWrappable(value)) {\n    return value;\n  }\n\n  let result = value;\n\n  if (!isWrapped(value)) {\n    const { children } = info;\n    const childInfo = getChildInfo(children, name);\n\n    if (childInfo) {\n      result = wrapFn(value, { info: childInfo });\n    } else {\n      const { deep, names, checker } = info;\n      result = wrapFn(value, { deep, names: [...names, name], checker });\n      storeChildInfoFrom(children, name, result);\n    }\n  }\n\n  return result;\n};\n","import { getTargetInfo } from '../target/info';\n\nimport {\n  getWrapConfigValue,\n  WRAP_FUNCTION_ARGUMENTS,\n  WRAP_FUNCTION_RETURN_VALUES,\n} from './config';\n\nimport { getTypeCheckedChild } from './utils';\n\nconst getTargetArguments = (wrapFn, target, argumentsList) => {\n  const info = getTargetInfo(target);\n\n  if (getWrapConfigValue(WRAP_FUNCTION_ARGUMENTS, info)) {\n    const { length } = argumentsList;\n    // FIXME cache arguments info objects as children\n    for (let index = 0; index < length; index++) {\n      argumentsList[index] = getTypeCheckedChild(\n        wrapFn,\n        info,\n        String(index),\n        argumentsList[index],\n      );\n    }\n  }\n\n  return argumentsList;\n};\n\nconst callFunction = (wrapFn) => (target, thisArg, argumentsList) => {\n  const info = getTargetInfo(target);\n  const { names, config, checker } = info;\n\n  if (checker.arguments) {\n    checker.arguments(target, thisArg, argumentsList, config, names);\n  }\n\n  argumentsList = getTargetArguments(wrapFn, target, argumentsList);\n\n  let result = target.apply(thisArg, argumentsList);\n\n  if (checker.returnValue) {\n    checker.returnValue(target, thisArg, result, config, names);\n  }\n\n  if (getWrapConfigValue(WRAP_FUNCTION_RETURN_VALUES, info)) {\n    result = getTypeCheckedChild(wrapFn, info, 'returnValue', result);\n  }\n\n  return result;\n};\n\nexport default callFunction;\n","import withProxy from '@actualwave/with-proxy';\nimport { getDefaultTypeChecker } from '../checkers';\nimport { getErrorReporter } from '../reporters';\nimport { isEnabled } from '../enabled';\nimport {\n  createTargetInfo,\n  setTargetInfo,\n  createChildrenCache,\n} from '../target/info';\nimport { isWrappable, isWrapped } from '../utils';\nimport getPropertyInit from './getProperty';\nimport setPropertyInit from './setProperty';\nimport callFunctionInit from './callFunction';\n\nlet wrapWithProxy; // eslint-disable-line\n\nconst createInfoFromOptions = (target, {\n  deep = true,\n  names = [],\n  config = null,\n  children = null,\n  checker = getDefaultTypeChecker(),\n  info = null, // exclusive option, if set other options being ignored\n} = {}) => info || createTargetInfo(\n  checker,\n  checker.init(target, getErrorReporter(), config),\n  deep,\n  names,\n  createChildrenCache(children),\n);\n\nconst create = (target, options) => {\n  if (!isWrappable(target) || !isEnabled() || isWrapped(target)) {\n    return target;\n  }\n\n  setTargetInfo(\n    target,\n    createInfoFromOptions(target, options),\n  );\n\n  return wrapWithProxy(target);\n};\n\nwrapWithProxy = (() => {\n  const callHandler = callFunctionInit(create);\n\n  return withProxy({\n    get: getPropertyInit(create),\n    set: setPropertyInit(create),\n    apply: callHandler,\n    construct: callHandler,\n  });\n})();\n\nexport {\n  createInfoFromOptions,\n  wrapWithProxy,\n};\n\nexport default create;\n","import { isEnabled } from '../enabled';\nimport { setTargetInfo, storeChildInfo, getChildInfo } from '../target/info';\nimport { isWrapped, isWrappable } from '../utils';\nimport { wrapWithProxy, createInfoFromOptions } from './create';\n\nconst deepInitializer = (target, options) => {\n  const info = createInfoFromOptions(target, options);\n  const { deep, names, checker, config, children } = info;\n\n  Object.keys(target).forEach((name) => {\n    const value = target[name];\n\n    checker.getProperty(target, name, value, config, names);\n\n    if (isWrappable(value)) {\n      let childInfo = getChildInfo(children, name);\n\n      if (childInfo) {\n        deepInitializer(value, { info: childInfo });\n      } else {\n        childInfo = deepInitializer(value, {\n          deep,\n          names: [...names, name],\n          checker,\n        });\n        storeChildInfo(children, name, childInfo);\n      }\n    }\n  });\n\n  setTargetInfo(target, info);\n\n  return info;\n};\n\nconst createDeep = (target, options) => {\n  if (\n    !target ||\n    typeof target !== 'object' ||\n    !isEnabled() ||\n    isWrapped(target)\n  ) {\n    return target;\n  }\n\n  deepInitializer(target, options);\n\n  return wrapWithProxy(target);\n};\n\nexport default createDeep;\n","import { getTargetInfo, hasTargetInfo } from '../info';\n\nimport create from '../../proxy/create';\n\nimport { isEnabled } from '../../enabled';\n\nconst merge = (options, ...sources) => {\n  let target = {};\n\n  if (isEnabled()) {\n    if (!options) {\n      options = {\n        info: getTargetInfo(sources.find((item) => hasTargetInfo(item))),\n        deep: false,\n      };\n    }\n\n    target = create(target, options);\n  }\n\n  return Object.assign(target, ...sources);\n};\n\nexport default merge;\n","import { isEnabled } from '../../enabled';\nimport { isWrappable, isWrapped } from '../../utils';\nimport create from '../../proxy/create';\n\n// TODO if enabled, replaces original value with type checked\nconst properties = (target, options = undefined, ...names) => {\n  if (!isEnabled()) {\n    return target;\n  }\n\n  if (!isWrappable(target)) {\n    throw new Error('Target must be a valid object.');\n  }\n\n  if (Object.isFrozen(target) || Object.isSealed(target)) {\n    throw new Error('Target object should not be sealed or frozen.');\n  }\n\n  if (!names.length) {\n    // Symbols and non-enumerables must be explicitly specified\n    names = Object.keys(target);\n  }\n\n  const { length } = names;\n  for (let index = 0; index < length; index += 1) {\n    const name = names[index];\n    const { writable, get, set } = Object.getOwnPropertyDescriptor(target, name);\n\n    // Prohibit applying to properties with accessor/mutator pair?\n    if ((get && set) || writable) {\n      const value = target[name];\n\n      if (isWrappable(value) && !isWrapped(value)) {\n        target[name] = create(value, options);\n      }\n    }\n  }\n\n  return target;\n};\n\nexport default properties;\n"],"names":["defaultTypeChecker","getDefaultTypeChecker","setDefaultTypeChecker","typeChecker","WRAP_FUNCTION_RETURN_VALUES","WRAP_FUNCTION_ARGUMENTS","WRAP_SET_PROPERTY_VALUES","PROXY_IGNORE_PROTOTYPE_METHODS","getDefaultWrapConfig","config","setWrapConfig","newConfig","Object","assign","getWrapConfig","getWrapConfigValue","key","info","hasOwn","require$$0","constructErrorString","action","name","required","received","ConsoleErrorReporter","requiredTypeString","actualTypeString","console","error","ConsoleWarnReporter","warn","ThrowErrorReporter","receivedTypeString","Error","errorReporter","getErrorReporter","setErrorReporter","reporter","enabled","isEnabled","setEnabled","value","INFO_KEY","Symbol","createChildrenCache","children","createTargetInfo","checker","deep","names","getTargetInfo","target","undefined","setTargetInfo","hasTargetInfo","getTypeChecker","getTypeCheckerData","getChildInfoKey","mergeChildrenCache","targetCache","sourceCache","mergeTargetInfo","storeChildInfo","cache","childInfo","storeChildInfoFrom","child","getChildInfo","targetInfo","sourceInfo","mergeConfigs","TARGET_KEY","unwrap","validTypes","isWrappable","Boolean","isWrapped","getTargetProperty","wrapFn","property","isFunction","isIgnoredProperty","getProperty","setNonTargetProperty","setProperty","setTargetProperty","getTypeCheckedChild","result","getTargetArguments","argumentsList","length","index","String","callFunction","thisArg","arguments","apply","returnValue","wrapWithProxy","createInfoFromOptions","init","create","options","callHandler","callFunctionInit","withProxy","getPropertyInit","setPropertyInit","deepInitializer","keys","forEach","createDeep","merge","sources","find","item","properties","isFrozen","isSealed","writable","get","set","getOwnPropertyDescriptor"],"mappings":"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"}
